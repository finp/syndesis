<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Operating on documents in a MongoDB collection :: Docs</title>
    <link rel="canonical" href="https://pwright.github.io/syndesis/docs/connecting/modules/connecting/proc-adding-mongodb-connections-write.html">
    <meta name="generator" content="Antora 2.3.1">
    <link rel="stylesheet" href="../../../../_/css/site.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://pwright.github.io/syndesis">Docs</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
         
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="is-primary" href="#"></a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="docs" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../../../index.html">Docs</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../../index.html"> Home</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../tutorials/master.html">Syndesis Sample Integration Tutorials</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../master.html">Connecting Syndesis to Applications and Services</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../customizing/master.html">Developing OpenAPI Documents and Extensions to Customize Syndesis</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../integrating-applications/master.html">Integrating Applications with Syndesis</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Docs</span>
    <span class="version">master</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Docs</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../../../index.html">master</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../../../index.html">Docs</a></li>
    <li><a href="proc-adding-mongodb-connections-write.html">Operating on documents in a MongoDB collection</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="file:///home/pwright/repos/doc-test/syndesis/antora/modules/ROOT/pages/connecting/modules/connecting/proc-adding-mongodb-connections-write.adoc"></a></div>
</div>
  <div class="content">
<article class="doc">
<h1 class="page">Operating on documents in a MongoDB collection</h1>
<div class="paragraph">
<p>In an integration, you can search for, update, delete, count, or
add a document to a MongoDB collection. To do this, add a
MongoDB connection to the middle of a flow or as a simple
integrationâ€™s finish connection.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You created a MongoDB connection.</p>
</li>
<li>
<p>You know the name of the MongoDB collection
that you want the connection to operate on.</p>
</li>
<li>
<p>You are creating or editing an integration and {prodname} is
prompting you to add to the integration. Or, {prodname} is
prompting you to choose a finish connection.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>On the <strong>Add to Integration</strong> page, click the plus sign where you
want to add a MongoDB connection. Skip this step if you are adding
a simple integration&#8217;s finish connection.</p>
</li>
<li>
<p>Click the MongoDB connection that you want to use.</p>
</li>
<li>
<p>On the <strong>Choose an action</strong> page, select the action that you want the
connection to perform.</p>
</li>
<li>
<p>To configure the action, in the <strong>Collection name</strong> field, enter
the name of the collection that you want the connection to
operate on.</p>
<div class="paragraph">
<p>If you selected the <strong>Insert</strong> action:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You are done configuring the connection.</p>
</li>
<li>
<p>Ensure that the data that the integration passes to this
MongoDB connection contains JSON notation that specifies the
document to add to the collection.</p>
</li>
<li>
<p>Click <strong>Next</strong> to add this connection to the integration.</p>
</li>
</ul>
</div>
</li>
<li>
<p>For all other actions, the following table provides information
about what to specify in the second field for configuring the action.</p>
<div class="paragraph">
<p>The second field is a JSON notation expression that identifies
the document(s) to operate on and possibly, details for the
operation. If you plan to map an incoming source field to an
identifier in the expression, specify <code>:#<em>variable-name</em></code> in
the expression.</p>
</div>
<div class="paragraph">
<p>For completeness, the <strong>Insert</strong> action is described in this
table as well.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 33.3333%;">
<col style="width: 33.3335%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Action</th>
<th class="tableblock halign-left valign-top">What it does</th>
<th class="tableblock halign-left valign-top">Parameter field</th>
<th class="tableblock halign-left valign-top">Returns</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Count</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Counts the number of documents that satisfy the count expression that you specify.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">In the <strong>Count expression</strong> field, specify a JSON filter expression in the form of <code>{"test":"unit"}</code>.
The action counts the number of documents that have a <code>test</code> attribute value of <code>unit</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An instance of <code>java.lang.Long</code> that specifies the number of documents that were found.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Delete</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Removes one or more documents from the collection.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">In the <strong>Delete expression</strong> field, specify a JSON expression in the form of <code>{"test":"unit"}</code>.
The operation removes each document whose <code>test</code> attribute has a value of <code>unit</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An instance of <code>java.lang.Long</code> that specifies the number of documents that were deleted.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Find</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Looks for all documents that match the filter expression that you specify.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">In the <strong>Filter expression</strong> field, specify a JSON notation string that identifies one or more documents.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JSON notation that specifies a list (an array). Each list element identifies a document that matches the
filter expression and provides the document content. If no documents are found, the action returns an empty list.<br>
<br>
You must be familiar with the data model of the collection. If the collection adheres to a JSON schema,
you must be familiar with this schema because the returned list elements adhere to this schema. For additional information, see
<a href="https://docs.mongodb.com/manual/data-modeling/">MongoDB Data Models</a>.<br>
<br>
To use output data from the <strong>Find</strong> action in a subsequent data mapper step,
the collection must adhere to a JSON schema. This enables the data mapper to
display data fields. For more information, see
<a href="https://docs.mongodb.com/manual/core/schema-validation/#json-schema">MongoDB documentation for JSON schema validation</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Insert</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adds one or more documents to the collection.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">There is no action configuration parameter for inserting a document. The data coming in
to the MongoDB connection must contain JSON notation that specifies one ore more documents to add to the collection.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JSON notation that specifies a list (an array). Each list element is a document that this action inserted.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Update</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Updates one or more documents in the collection.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">In the <strong>Filter criteria</strong> field, specify an array of 2 arguments.
The first argument is a filter expression that identifies the documents to update.
The second argument is a MongoDB update statement that specifies how to update the documents. Update statement
format is described in <a href="https://docs.mongodb.com/manual/reference/method/db.collection.update/" class="bare">https://docs.mongodb.com/manual/reference/method/db.collection.update/</a>. For example:
<code>[{"_id":11},{$set: {"test":"updated!"}}]</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An instance of <code>java.lang.Long</code> that specifies the number of documents that were updated.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Upsert</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Updates one or more documents in the collection or creates a document if no documents match the <strong>Upsert expression</strong>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">In the <strong>Upsert expression</strong> field, specify JSON notation that identifies one or more documents. The action uses this expression
to detect any matching documents. If the action finds a matching document(s) in the collection, it updates it. If the action does
not find a matching document, the action creates a new document.
The data coming into the MongoDB connection must contain JSON notation that specifies:</p>
<p class="tableblock">* An <code>_id</code> field to identify whether it is an insert or an update operation.</p>
<p class="tableblock">* The content to add or update.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An instance of <code>com.mongodb.client.result.UpdateResult</code> that specifies either the number of updated documents or the ID of the new, inserted document.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Each action returns a response. If this is a finish connection, then
the response is lost, but you can add a <strong>Log</strong> step to capture the response.</p>
</div>
</li>
<li>
<p>Click <strong>Next</strong>.</p>
</li>
<li>
<p>Optional. If this is a finish connection, add a <strong>Log</strong> step to finish the
integration instead. Configure the <strong>Log</strong> step to capture the response.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Result</div>
<p>The connection appears in the integration visualization where
you added it.</p>
</div>
<div class="paragraph">
<div class="title">Next steps</div>
<p>Add any other needed connections to the flow. Add any other steps that
process data. Complete the integration by adding any needed data mapping steps.
When you configured the MongoDB connection action, if you specified any
<code>:#<em>variable-name</em></code> identifiers in an action expression, be sure to map a
source field to the MongoDB connection variable field.</p>
</div>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../../../_/js/site.js"></script>
<script async src="../../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
